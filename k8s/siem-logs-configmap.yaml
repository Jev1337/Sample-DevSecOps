apiVersion: v1
kind: ConfigMap
metadata:
  name: siem-sample-logs
  namespace: monitoring
data:
  auth.log: |
    Jul 14 16:30:01 host-001 sshd[12345]: Failed password for invalid user admin from 192.168.1.100 port 45123 ssh2
    Jul 14 16:30:15 host-001 sshd[12346]: Failed password for root from 10.0.0.50 port 33456 ssh2
    Jul 14 16:30:30 host-001 sshd[12347]: Accepted publickey for azureuser from 192.168.1.10 port 22 ssh2
    Jul 14 16:31:01 host-001 sshd[12348]: Failed password for invalid user test from 172.16.0.25 port 55789 ssh2
    Jul 14 16:31:15 host-001 sudo[12349]: azureuser : TTY=pts/0 ; PWD=/home/azureuser ; USER=root ; COMMAND=/usr/bin/microk8s kubectl get pods
    Jul 14 16:31:30 host-001 sshd[12350]: authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=203.0.113.45 user=root
    Jul 14 16:32:01 host-001 sshd[12351]: Invalid user hacker from 198.51.100.75 port 12345 ssh2
    Jul 14 16:32:15 host-001 sshd[12352]: Failed password for ubuntu from 203.0.113.100 port 54321 ssh2
    Jul 14 16:32:30 host-001 sshd[12353]: Accepted password for azureuser from 192.168.1.10 port 22 ssh2
    Jul 14 16:33:01 host-001 sshd[12354]: Failed password for invalid user oracle from 172.16.0.99 port 33333 ssh2
  audit.log: |
    {"kind":"Event","apiVersion":"audit.k8s.io/v1","level":"Metadata","auditID":"12345678-1234-1234-1234-123456789abc","stage":"ResponseComplete","requestURI":"/api/v1/namespaces/monitoring/pods","verb":"list","user":{"username":"system:serviceaccount:monitoring:alloy","groups":["system:serviceaccounts","system:serviceaccounts:monitoring","system:authenticated"]},"sourceIPs":["10.1.1.5"],"userAgent":"alloy/v1.0.0","objectRef":{"resource":"pods","namespace":"monitoring","apiVersion":"v1"},"responseStatus":{"metadata":{},"code":200},"requestReceivedTimestamp":"2025-07-14T16:30:00.000000Z","stageTimestamp":"2025-07-14T16:30:00.100000Z"}
    {"kind":"Event","apiVersion":"audit.k8s.io/v1","level":"Metadata","auditID":"12345678-1234-1234-1234-123456789def","stage":"ResponseComplete","requestURI":"/api/v1/namespaces/default/secrets","verb":"create","user":{"username":"system:admin","groups":["system:masters","system:authenticated"]},"sourceIPs":["192.168.1.10"],"userAgent":"kubectl/v1.25.0","objectRef":{"resource":"secrets","namespace":"default","name":"app-secret","apiVersion":"v1"},"responseStatus":{"metadata":{},"code":201},"requestReceivedTimestamp":"2025-07-14T16:31:00.000000Z","stageTimestamp":"2025-07-14T16:31:00.150000Z"}
    {"kind":"Event","apiVersion":"audit.k8s.io/v1","level":"Metadata","auditID":"12345678-1234-1234-1234-123456789ghi","stage":"ResponseComplete","requestURI":"/api/v1/namespaces/kube-system/configmaps","verb":"delete","user":{"username":"system:anonymous","groups":["system:unauthenticated"]},"sourceIPs":["203.0.113.45"],"userAgent":"curl/7.68.0","objectRef":{"resource":"configmaps","namespace":"kube-system","name":"important-config","apiVersion":"v1"},"responseStatus":{"metadata":{},"code":403},"requestReceivedTimestamp":"2025-07-14T16:32:00.000000Z","stageTimestamp":"2025-07-14T16:32:00.200000Z"}
    {"kind":"Event","apiVersion":"audit.k8s.io/v1","level":"Metadata","auditID":"12345678-1234-1234-1234-123456789jkl","stage":"ResponseComplete","requestURI":"/api/v1/namespaces/monitoring/pods/grafana-6ddcb8947f-bzpvq","verb":"get","user":{"username":"system:serviceaccount:monitoring:grafana","groups":["system:serviceaccounts","system:serviceaccounts:monitoring","system:authenticated"]},"sourceIPs":["10.1.1.8"],"userAgent":"grafana/v9.0.0","objectRef":{"resource":"pods","namespace":"monitoring","name":"grafana-6ddcb8947f-bzpvq","apiVersion":"v1"},"responseStatus":{"metadata":{},"code":200},"requestReceivedTimestamp":"2025-07-14T16:33:00.000000Z","stageTimestamp":"2025-07-14T16:33:00.250000Z"}
    {"kind":"Event","apiVersion":"audit.k8s.io/v1","level":"Metadata","auditID":"12345678-1234-1234-1234-123456789mno","stage":"ResponseComplete","requestURI":"/api/v1/namespaces/default/services","verb":"patch","user":{"username":"system:node:node-001","groups":["system:nodes","system:authenticated"]},"sourceIPs":["10.0.0.5"],"userAgent":"kubelet/v1.25.0","objectRef":{"resource":"services","namespace":"default","name":"suspicious-service","apiVersion":"v1"},"responseStatus":{"metadata":{},"code":200},"requestReceivedTimestamp":"2025-07-14T16:34:00.000000Z","stageTimestamp":"2025-07-14T16:34:00.300000Z"}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: siem-generator-script
  namespace: monitoring
data:
  generate-logs.sh: |
    #!/bin/bash
    while true; do
      # Generate SSH auth events
      echo "$(date '+%b %d %H:%M:%S') host-$(( RANDOM % 10 + 1 )) sshd[$(( RANDOM % 10000 + 10000 ))]: Failed password for invalid user admin from 192.168.1.$(( RANDOM % 255 + 1 )) port $(( RANDOM % 50000 + 10000 )) ssh2" >> /var/log/auth.log
      
      # Generate K8s audit events
      AUDIT_ID=$(uuidgen 2>/dev/null || echo "$(( RANDOM ))-$(( RANDOM ))-$(( RANDOM ))-$(( RANDOM ))-$(( RANDOM ))")
      echo "{\"kind\":\"Event\",\"apiVersion\":\"audit.k8s.io/v1\",\"level\":\"Metadata\",\"auditID\":\"$AUDIT_ID\",\"stage\":\"ResponseComplete\",\"requestURI\":\"/api/v1/namespaces/default/pods\",\"verb\":\"list\",\"user\":{\"username\":\"system:anonymous\",\"groups\":[\"system:unauthenticated\"]},\"sourceIPs\":[\"203.0.113.$(( RANDOM % 255 + 1 ))\"],\"userAgent\":\"suspicious-client/1.0\",\"objectRef\":{\"resource\":\"pods\",\"namespace\":\"default\",\"apiVersion\":\"v1\"},\"responseStatus\":{\"metadata\":{},\"code\":403},\"requestReceivedTimestamp\":\"$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)\",\"stageTimestamp\":\"$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)\"}" >> /var/log/audit.log
      
      sleep 30
    done
