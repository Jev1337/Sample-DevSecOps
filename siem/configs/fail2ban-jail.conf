# Fail2Ban Configuration for SSH Protection
# Custom jail configuration for DevSecOps environment

[DEFAULT]
# Global settings
bantime = 3600
findtime = 600
maxretry = 3
backend = auto
usedns = warn
logencoding = auto
enabled = false
filter = %(__name__)s
destemail = admin@devsecops.local
sender = fail2ban@devsecops.local
mta = sendmail
protocol = tcp
chain = <known/chain>
port = 0:65535
fail2ban_agent = Fail2Ban/%(fail2ban_version)s

# SSH jail configuration
[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 3600
findtime = 600

# HTTP authentication failures
[apache-auth]
enabled = true
port = http,https
filter = apache-auth
logpath = /var/log/apache2/error.log
maxretry = 6

[nginx-http-auth]
enabled = true
port = http,https
filter = nginx-http-auth
logpath = /var/log/nginx/error.log
maxretry = 6

# Custom jail for application authentication failures
[flask-auth]
enabled = true
port = 5000
filter = flask-auth
logpath = /var/log/flask/flask.log
maxretry = 5
bantime = 1800
findtime = 300

# Custom jail for Jenkins authentication failures
[jenkins-auth]
enabled = true
port = 8080
filter = jenkins-auth
logpath = /var/log/jenkins/jenkins.log
maxretry = 5
bantime = 3600

# Custom jail for SonarQube authentication failures
[sonarqube-auth]
enabled = true
port = 9000
filter = sonarqube-auth
logpath = /var/log/sonarqube/web.log
maxretry = 5
bantime = 3600

# DDoS protection
[http-get-dos]
enabled = true
port = http,https
filter = http-get-dos
logpath = /var/log/nginx/access.log
maxretry = 300
findtime = 300
bantime = 600

# Recidive jail for repeat offenders
[recidive]
enabled = true
filter = recidive
logpath = /var/log/fail2ban.log
action = iptables-allports[name=recidive]
bantime = 86400
findtime = 86400
maxretry = 5
